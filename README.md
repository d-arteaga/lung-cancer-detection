# Lung Cancer Detection Project

This project focuses on analyzing lung nodule malignancy and preprocessing extracted nodule images using the LIDC-IDRI dataset of CT scan DICOM images and XML radiologist annotations. The primary goal is to categorize patients into benign, malignant, or uncertain categories based on their mean malignancy scores, extract nodule images, and preprocess them for training a lung cancer detection model.

Link to dataset: https://www.cancerimagingarchive.net/collection/lidc-idri/ 

---

## Notebooks Overview

### `malignancy.ipynb`

The `malignancy.ipynb` notebook processes XML annotations from the LIDC-IDRI dataset to extract malignancy scores for lung nodules and categorizes patients based on their mean malignancy scores.

#### Key Features:
1. **XML Parsing**:
   - Extracts malignancy scores from the `unblindedReadNodule` elements in the XML files.
   - Maps malignancy scores to DICOM images using `imageSOP_UID`.

2. **Mean Malignancy Score Calculation**:
   - Calculates the mean malignancy score for each patient based on all nodules.

3. **Patient Categorization**:
   - Categorizes patients into:
     - **Benign**: Mean malignancy score between 1 and 2.
     - **Malignant**: Mean malignancy score between 4 and 5.
     - **Uncertain**: Scores outside these ranges or missing data.

4. **CSV Export**:
   - Outputs categorized patient data to `malignancy_label.csv`.
   - Saves detailed malignancy scores to `malignancy_scores.csv`.

#### Outputs:
- **`malignancy_label.csv`**:
  - Contains patient IDs and their corresponding categories (benign, malignant, or uncertain).
- **`malignancy_scores.csv`**:
  - Contains detailed malignancy scores for each DICOM image.

#### How to Run:
1. Ensure the LIDC-IDRI dataset is placed in the `Data/LIDC-IDRI/` directory.
2. Open the `malignancy.ipynb` notebook in Jupyter Notebook or JupyterLab.
3. Execute the cells to process the dataset and generate outputs.

---

### `extract_nodule_images.ipynb`

The `extract_nodule_images.ipynb` notebook extracts lung nodule images from the LIDC-IDRI dataset based on the ROI (Region of Interest) coordinates provided in the XML annotations.

#### Key Features:
1. **XML Parsing**:
   - Extracts ROI coordinates from the `unblindedReadNodule` elements in the XML files.
   - Maps the ROI coordinates to DICOM images using `imageSOP_UID`.

2. **DICOM Image Matching**:
   - Searches for DICOM files corresponding to the extracted ROI coordinates.
   - Matches the `SOPInstanceUID` in the XML file with the DICOM metadata.

3. **ROI Cropping**:
   - Crops the lung nodule regions from the DICOM images based on the extracted ROI coordinates.
   - Normalizes the cropped images for consistency.

4. **Output**:
   - Saves the cropped lung nodule images to an output directory, organized by patient ID and nodule ID.

#### Outputs:
- Cropped lung nodule images saved in the `output/` directory:
  - Example structure:
    ```
    output/
      ├── benign_patient_4/
      │   ├── nodule_1_SOPUID.png
      │   ├── nodule_2_SOPUID.png
      │   └── ...
      └── malignant_patient_1/
          ├── nodule_1_SOPUID.png
          ├── nodule_3_SOPUID.png
          └── ...
    ```

#### How to Run:
1. Ensure the LIDC-IDRI dataset is placed in the `Data/LIDC-IDRI/` directory.
2. Open the `extract_nodule_images.ipynb` notebook in Jupyter Notebook or JupyterLab.
3. Execute the cells to process the dataset and generate cropped lung nodule images.

---

### `preprocess.ipynb`

The `preprocess.ipynb` notebook preprocesses the extracted lung nodule images to prepare them for training a Convolutional Neural Network (CNN).

#### Key Features:
1. **Image Resizing**:
   - Resizes all images to a consistent dimension (e.g., 128x128), necessary for CNNs.

2. **Normalization**:
   - Normalizes pixel values to the range [0, 1] for faster convergence during training.

3. **Data Augmentation**:
   - Augments the dataset using techniques like rotation, flipping, and zooming to increase diversity and reduce overfitting.

4. **Class Balancing**:
   - Balances the dataset by augmenting or downsampling the minority class.

5. **Dataset Splitting**:
   - Splits the dataset into training, validation, and test sets.

6. **Saving Preprocessed Data**:
   - Saves the preprocessed datasets (`X_train`, `y_train`, `X_val`, `y_val`, `X_test`, `y_test`) into a `preprocessed/` folder for future use.

#### Outputs:
- Preprocessed datasets saved in the `preprocessed/` directory:
  - Example files:
    ```
    preprocessed/
      ├── X_train.npy
      ├── y_train.npy
      ├── X_val.npy
      ├── y_val.npy
      ├── X_test.npy
      └── y_test.npy
    ```

#### How to Run:
1. Ensure the cropped nodule images are saved in the `output/` directory.
2. Open the `preprocess.ipynb` notebook in Jupyter Notebook or JupyterLab.
3. Execute the cells to preprocess the images and save the datasets.

---

## Future Work

The preprocessed datasets generated by `preprocess.ipynb` can be used to train machine learning or deep learning models (e.g., CNNs) to classify nodules as benign or malignant. The malignancy scores and categories from `malignancy.ipynb` can also be used to label the data for supervised learning.